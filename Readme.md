## USB HID Device using STM32F4 
This repository holds the USB Host side of firmware necessary for the "Super Mouse" usb-usb converter. It uses the ST32CubeMX generated HAL libraries for initialization and accessing USB and other peripherals.

## Folder structure

-- glue_blocks: contains my simple (but effective) circular_buffer implementation used by UART DMA for RX & TX, SPI for RX, and USB HID for queuing HID reports

-- Core: autogen by the STM32CubeMX, contains main.cpp

-- Drivers: autogenerated, houses CMSIS & ST's HAL Libraries

-- Drivers/HID_Device_Drivers: contains the abstraction layer for MMORPG computer mice. Also has an implementation for a HID Driver for the Logitech G600.

-- Middlewares: autogenerated

-- USB_HOST: autogenerated, modified heavily to support multiple HID Enpoints


## Birds-eye view of how things connect
1. The USB Host STM32F4xx uC (powered by the firmware in this repo) acts as the usb host for the MMORPG Mouse of choice. It decodes HID Reports, and sends over mouse state changes (that would be any X, Y, Scroll movement or a change in the buttons) via SPI to the STM32F4xx uC running the (USB Device FW)[https://github.com/pragun/super_mouse_stm32f4_usb_device].

2. `mmo_mouse_hid_driver` files in `Drivers/HID_Device_Drivers` provide a simple abstraction to represent the state of a MMORPG mouse. Most of which, have 12 thumb-keys, and several extra buttons in addition to the left, middle, right mouse buttons. 
```
#pragma pack(1)
typedef struct
{
	int16_t dx;
	int16_t dy;
	int8_t dz;
	uint32_t buttons;
}
MMO_Mouse_State_TypeDef;
```

3. `logitech_g600` implements a concrete HID driver over the `generic_hid_driver` for the Logitech G00 mouse, which presents the mouse state in the structure mentioned above. 

## References 
1. [Repo for the USB Host Interface](https://github.com/pragun/super_mouse_stm32f4_usb_host)
2. [Repo for the Super Mouse Utility](https://github.com/pragun/super_mouse_utilities) 
